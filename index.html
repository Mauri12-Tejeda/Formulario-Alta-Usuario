<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solicitud de Alta de Usuario – Ministerio de Seguridad CABA</title>

  <!-- Fuentes y librerías -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Libre+Franklin:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;
      background:#003366; /* Fondo oscuro */
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      padding:20px;
    }

    /* === BOTONES SUPERIORES === */
    .toolbar{
      position:sticky;top:0;z-index:10;
      display:flex;gap:10px;justify-content:center;
      padding:12px 0;margin-bottom:20px;
    }
    .btn{
      background:#007BFF;color:#fff;border:0;
      border-radius:10px;padding:10px 16px;
      font-weight:700;cursor:pointer;
      box-shadow:0 4px 12px rgba(0,0,0,.3);
      transition:background .2s ease,transform .15s ease;
    }
    .btn:hover{background:#0056b3;transform:translateY(-1px)}
    .btn.secondary{background:#6c757d}
    .btn.secondary:hover{background:#545b62}

    /* === HOJA A4 === */
    .sheet{
      width:210mm;height:297mm;
      padding:10mm;
      background:#fff;
      border-radius:10px;
      border:2px solid #1a1a1a;
      margin:auto;
      box-shadow:0 4px 15px rgba(0,0,0,.2);
      page-break-inside:avoid;
    }

    /* === ENCABEZADO === */
    .encabezado{
      border:1.6px solid #cfcfcf;
      border-radius:6px;
      background:#ffffff;
      margin-bottom:12px;
      overflow:hidden;
    }
    .enc-top{display:flex;align-items:center}
    .enc-logo{
      border-right:1px solid #ddd;
      width:180px;display:flex;
      align-items:center;justify-content:center;
      padding:10px;
      background:#fafafa;
    }
    .enc-logo img{max-height:50px;width:auto;object-fit:contain}
    .enc-titulos{flex:1;text-align:center;padding:10px}
    .enc-titulo{font-weight:700;font-size:22px;color:#000}
    .enc-sub{margin-top:4px;font-weight:600;font-size:14px;color:#222}
    .enc-barra{
      background:#007BFF;color:#fff;
      font-weight:700;padding:8px 14px;
      font-size:15px;text-align:left;
    }

    /* === SECCIONES === */
    .seccion{
      border:1px solid #999;
      border-radius:6px;
      background:#f9fafb;
      margin-bottom:14px;
    }
    .seccion h3{
      background:#007BFF;
      color:#fff;
      padding:6px 10px;
      margin:0;
      font-size:15px;
      font-weight:700;
      border-radius:6px 6px 0 0;
    }

    .grupo{display:flex;flex-wrap:wrap;gap:10px;padding:10px}
    .campo{flex:1 1 200px;display:flex;flex-direction:column}
    label{font-weight:600;margin-bottom:3px;font-size:13px;color:#111}
    input,textarea{
      width:100%;
      border:none;
      border-bottom:1px dashed #7e8790;
      padding:5px 3px;
      font:inherit;
      outline:none;
      background:transparent;
      font-size:13px;
    }
    input[type="date"]{
      border:1px solid #cfd6df;
      border-radius:4px;
      padding:5px 6px;
      font-size:13px;
      background:#fff;
    }
    input:focus,textarea:focus{
      outline:none;
      border-color:#007BFF;
      background:#eef5ff;
    }
    .invalid{outline:2px solid #c1121f !important; background:#fff2f2}
    .req{color:#c1121f;font-weight:700}

    /* === AVISO === */
    .notice{
      border:1px solid #000;
      border-radius:4px;
      background:#fff;
      margin-top:8px;
      padding:6px;
    }
    .notice-head{
      background:#000;color:#fff;
      text-align:center;font-weight:700;
      padding:5px;margin:-1px -1px 5px -1px;
      border-radius:4px 4px 0 0;
      font-size:12.5px;
    }
    .notice-list{margin:0 0 0 18px;padding:0;font-size:12px}
    .notice-list li{margin:2mm 0;line-height:1.35}
    .notice a{color:#0a58ca;text-decoration:underline}

    @media print{
      @page{margin:0;}
      body{background:#fff;}
      .toolbar{display:none!important}
      .sheet{box-shadow:none;border:2px solid #1a1a1a}
    }
  </style>
</head>
<body>

  <div class="toolbar">
    <button id="btnPdf" class="btn">Convertir a PDF</button>
    <button id="btnClear" class="btn secondary">Limpiar Formulario</button>
  </div>

  <div id="doc">
    <!-- ===== HOJA 1 ===== -->
    <section id="hoja1" class="sheet">
      <div class="encabezado">
        <div class="enc-top">
          <div class="enc-logo"><img src="./logo-para-VPN.png" alt=""></div>
          <div class="enc-titulos">
            <div class="enc-titulo">Directorio Activo - Dominio</div>
            <div class="enc-sub">Ministerio de Seguridad - CABA</div>
          </div>
        </div>
        <div class="enc-barra">Formulario de solicitud Alta de Usuario de Windows</div>
      </div>

      <div class="seccion">
        <h3>Solicitud</h3>
        <div class="grupo">
          <div class="campo">
            <label class="req">Fecha de Solicitud</label>
            <input type="date" id="fecha" required>
          </div>
        </div>
      </div>

      <div class="seccion">
        <h3>Datos del Solicitante a Crear Usuario</h3>
        <div class="grupo">
          <div class="campo">
            <label class="req">Apellido y Nombres</label>
            <input id="nombre" required>
          </div>
          <div class="campo">
            <label class="req">Nro de CUIL</label>
            <input id="cuil" maxlength="11" required pattern="^\d{11}$" oninput="this.value=this.value.replace(/\\D/g,'').slice(0,11)">
          </div>
        </div>

        <div class="grupo">
          <div class="campo"><label>LP</label><input></div>
          <div class="campo"><label>Grado/Jerarquía</label><input></div>
        </div>
        <div class="grupo">
          <div class="campo"><label>Subsecretaría / Superintendencia</label><input></div>
        </div>
        <div class="grupo">
          <div class="campo"><label>División / Departamento</label><input></div>
          <div class="campo"><label>Dependencia</label><input></div>
        </div>
        <div class="grupo">
          <div class="campo"><label>Calle</label><input></div>
          <div class="campo"><label>Nro</label><input pattern="\\d*"></div>
          <div class="campo"><label>Piso</label><input pattern="\\d*"></div>
        </div>
        <div class="grupo">
          <div class="campo">
            <label class="req">E-mail Personal Institucional</label>
            <input id="emailSolic" type="email" required pattern="^[a-zA-Z0-9._%+-]+@(buenosaires\\.gob\\.ar|policiadelaciudad\\.gob\\.ar|seguridadciudad\\.gob\\.ar)$">
          </div>
          <div class="campo"><label>Teléfono / Interno</label><input pattern="\\d*"></div>
        </div>
      </div>

      <div class="seccion">
        <h3>Responsable de la Dependencia</h3>
        <div class="grupo">
          <div class="campo"><label>Apellido y Nombres</label><input></div>
          <div class="campo"><label>Cargo</label><input></div>
          <div class="campo"><label>LP</label><input></div>
        </div>
        <div class="grupo">
          <div class="campo"><label>División / Departamento</label><input></div>
          <div class="campo">
            <label>E-mail Institucional</label>
            <input id="emailResp" type="email" pattern="^[a-zA-Z0-9._%+-]+@(buenosaires\\.gob\\.ar|policiadelaciudad\\.gob\\.ar|seguridadciudad\\.gob\\.ar)$">
          </div>
          <div class="campo"><label>Teléfono / Interno</label><input pattern="\\d*"></div>
        </div>
      </div>

      <div class="notice">
        <div class="notice-head">AVISO IMPORTANTE</div>
        <ol class="notice-list">
          <li>Ante cualquier duda comuníquese al correo: <a href="mailto:dominio_mjys@buenosaires.gob.ar">dominio_mjys@buenosaires.gob.ar</a>.</li>
          <li>No se recibirán formularios escritos a mano.</li>
        </ol>
      </div>
    </section>

    <!-- ===== HOJA 2 ===== -->
    <section id="instructivo" class="sheet">
      <div class="encabezado">
        <div class="enc-top">
          <div class="enc-logo"><img src="./logo-para-VPN.png" alt=""></div>
          <div class="enc-titulos">
            <div class="enc-titulo">Instrucciones</div>
            <div class="enc-sub">Ministerio de Seguridad - CABA</div>
          </div>
        </div>
        <div class="enc-barra">Instrucciones para completar el formulario</div>
      </div>

      <ol style="font-size:13px;line-height:1.5;">
        <li>Completar la Fecha del requerimiento.</li>
        <li>Datos del solicitante: Persona a dar de alta como Usuario de Dominio.</li>
        <li>Indicar Número de CUIL y LP (si corresponde).</li>
        <li>Indicar Dependencia y División/Departamento.</li>
        <li>Completar correo institucional y teléfono de contacto.</li>
        <li>Indicar datos del responsable (Apellido, Cargo, LP, e-mail, teléfono).</li>
      </ol>

      <p style="margin-top:12px;font-weight:600;color:#0033cc;">
        IMPORTANTE: NO SE RECIBEN FORMULARIOS ESCRITOS A MANO.
      </p>
    </section>
  </div>

  <script>
    function setTodayIfEmpty(){
      const d=new Date();const pad=n=>String(n).padStart(2,'0');
      const iso=`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      const f=document.getElementById('fecha');if(f&&!f.value)f.value=iso;
    }
    document.addEventListener('DOMContentLoaded',setTodayIfEmpty);

    const allowedDomains=["buenosaires.gob.ar","policiadelaciudad.gob.ar","seguridadciudad.gob.ar"];
    function isAllowedEmail(email){
      const at=email.indexOf("@");if(at===-1)return false;
      return allowedDomains.includes(email.slice(at+1).toLowerCase().trim());
    }

    function validar(){
      let ok=true;
      const reqs=['nombre','cuil','emailSolic'];
      reqs.forEach(id=>{
        const el=document.getElementById(id);
        if(!el)return;el.classList.remove('invalid');
        if(!el.value.trim()||!el.checkValidity()){el.classList.add('invalid');ok=false;}
      });
      ['emailSolic','emailResp'].forEach(id=>{
        const e=document.getElementById(id);
        if(e&&e.value&&!isAllowedEmail(e.value)){e.classList.add('invalid');ok=false;}
      });
      return ok;
    }

    async function nodeToDataURL(el){
      const worker=html2pdf().set({
        margin:0,
        image:{type:'jpeg',quality:0.98},
        html2canvas:{
          backgroundColor:'#ffffff',scale:2,useCORS:true,
          onclone:doc=>{const tb=doc.querySelector('.toolbar');if(tb)tb.style.display='none';}
        },
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
      }).from(el).toCanvas();
      const canvas=await worker.get('canvas');
      return canvas.toDataURL('image/jpeg',0.98);
    }

    document.getElementById('btnPdf').addEventListener('click',async()=>{
      if(!validar()){alert('Complete los campos obligatorios o corrija los e-mails.');return;}
      const hoja1=document.getElementById('hoja1');
      const hoja2=document.getElementById('instructivo');
      const cuil=(document.getElementById('cuil')?.value||'SIN-CUIL').replace(/\D/g,'').slice(0,11)||'SIN-CUIL';
      const [img1,img2]=await Promise.all([nodeToDataURL(hoja1),nodeToDataURL(hoja2)]);
      const pdf=new jspdf.jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
      pdf.addImage(img1,'JPEG',0,0,210,297);
      pdf.addPage();
      pdf.addImage(img2,'JPEG',0,0,210,297);
      pdf.save(`Alta Usuario - ${cuil}.pdf`);
    });

    document.getElementById('btnClear').addEventListener('click',()=>{
      document.querySelectorAll('#hoja1 input,#hoja1 textarea').forEach(el=>{
        el.value='';el.classList.remove('invalid');
      });
      setTodayIfEmpty();
    });
  </script>
</body>
</html>
